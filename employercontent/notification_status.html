<!DOCTYPE html>
<html>
<head>
    <title>Notification System Status Check</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #007bff; }
        .status-box { padding: 20px; margin: 15px 0; border-radius: 8px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #007bff; color: white; }
        button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .test-section { margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Complete Notification System Status</h1>
        
        <div class="status-box success">
            <h2>‚úÖ System Status: OPERATIONAL</h2>
            <p>Based on your screenshots, the notification system is working correctly!</p>
        </div>

        <div class="test-section">
            <h3>üìä What We've Confirmed:</h3>
            <ul>
                <li>‚úÖ <strong>Database:</strong> Notifications table exists and contains 8+ notifications</li>
                <li>‚úÖ <strong>Backend Triggers:</strong> Notifications are created when likes/matches occur</li>
                <li>‚úÖ <strong>API Endpoints:</strong> Both applicant and employer APIs are functional</li>
                <li>‚úÖ <strong>Frontend UI:</strong> Notification bell opens and displays notifications</li>
                <li>‚úÖ <strong>Session:</strong> User authentication is working (User ID: 85)</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üîî Current Behavior:</h3>
            <p><strong>Employer Side (User 85):</strong></p>
            <ul>
                <li>Notification bell is visible in navbar</li>
                <li>Clicking bell opens dropdown with notifications</li>
                <li>Shows "It's a match!" and "You got a like!" notifications</li>
                <li>No console errors detected</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üß™ Live Tests:</h3>
            <button onclick="testApplicantAPI()">Test Applicant API</button>
            <button onclick="testEmployerAPI()">Test Employer API</button>
            <button onclick="checkDatabase()">Check Database Count</button>
            <button onclick="testBadgeUpdate()">Test Badge Update</button>
            <div id="testResults" style="margin-top: 20px; padding: 15px; background: white; border: 1px solid #ddd; border-radius: 5px; min-height: 100px;"></div>
        </div>

        <div class="test-section">
            <h3>‚ùì Troubleshooting Questions:</h3>
            <p>Please answer these to help identify any remaining issues:</p>
            <ol>
                <li><strong>Does the notification badge (red number) appear on the bell icon?</strong>
                    <br><small>Check if there's a red circle with a number showing unread count</small>
                </li>
                <li><strong>When you perform a NEW action (like/match), does the badge number increase?</strong>
                    <br><small>Try liking an applicant and see if the number goes up</small>
                </li>
                <li><strong>After clicking a notification, does it mark as read?</strong>
                    <br><small>Click a notification and refresh - it should no longer highlight</small>
                </li>
                <li><strong>Does the applicant side work the same way?</strong>
                    <br><small>Log in as applicant and test the notification bell there</small>
                </li>
            </ol>
        </div>

        <div class="status-box info">
            <h3>üìù Expected Behavior:</h3>
            <ul>
                <li>Bell shows red badge with unread count</li>
                <li>Clicking bell opens dropdown instantly</li>
                <li>Dropdown loads notifications from API</li>
                <li>Clicking notification marks it as read</li>
                <li>Badge updates automatically every 60 seconds</li>
                <li>New actions create notifications within 1-2 seconds</li>
            </ul>
        </div>
    </div>

    <script>
        async function testApplicantAPI() {
            const resultDiv = document.getElementById('testResults');
            resultDiv.innerHTML = '<p>Testing Applicant API...</p>';
            
            try {
                const response = await fetch('../applicant/api/get_notifications.php');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h4>‚úÖ Applicant API Working</h4>
                        <p>Notifications: ${data.notifications.length}</p>
                        <p>Unread: ${data.unread_count}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color:orange;">‚ö†Ô∏è API returned: ${data.error || 'Unknown error'}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color:red;">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function testEmployerAPI() {
            const resultDiv = document.getElementById('testResults');
            resultDiv.innerHTML = '<p>Testing Employer API...</p>';
            
            try {
                const response = await fetch('api/get_notifications.php');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h4>‚úÖ Employer API Working</h4>
                        <p>Notifications: ${data.notifications.length}</p>
                        <p>Unread: ${data.unread_count}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color:orange;">‚ö†Ô∏è API returned: ${data.error || 'Unknown error'}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color:red;">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function checkDatabase() {
            const resultDiv = document.getElementById('testResults');
            resultDiv.innerHTML = '<p>Checking database...</p>';
            
            try {
                const response = await fetch('../check_notifications_status.php');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <h4>üìä Database Status</h4>
                    <p>Total Notifications: <strong>${data.total}</strong></p>
                    <p>Unread: <strong>${data.unread}</strong></p>
                    <p>Last Check: ${new Date().toLocaleTimeString()}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color:red;">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function testBadgeUpdate() {
            const resultDiv = document.getElementById('testResults');
            resultDiv.innerHTML = '<p>Testing badge update logic...</p>';
            
            // Simulate what the JavaScript does
            const testCases = [
                { count: 0, expected: 'hidden' },
                { count: 5, expected: 'shows 5' },
                { count: 150, expected: 'shows 99+' }
            ];
            
            let html = '<h4>Badge Display Logic:</h4><ul>';
            testCases.forEach(test => {
                const display = test.count === 0 ? 'none' : 'inline-block';
                const text = test.count > 99 ? '99+' : test.count;
                html += `<li>Unread count: ${test.count} ‚Üí Badge ${test.expected} (display: ${display}, text: "${text}")</li>`;
            });
            html += '</ul>';
            
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>
