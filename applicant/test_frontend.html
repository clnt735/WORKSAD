<!DOCTYPE html>
<html>
<head>
    <title>Applicant Notification Frontend Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .result-box { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; border: 1px solid #ddd; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Applicant Notification Frontend Debug</h1>
        
        <h3>Test 1: Check DOM Elements</h3>
        <button onclick="checkElements()">Check Elements</button>
        <div id="elementsResult" class="result-box"></div>

        <h3>Test 2: Test API Call</h3>
        <button onclick="testAPI()">Call API</button>
        <div id="apiResult" class="result-box"></div>

        <h3>Test 3: Test Badge Update</h3>
        <button onclick="testBadge()">Test Badge Logic</button>
        <div id="badgeResult" class="result-box"></div>

        <h3>Test 4: Simulate Full Load</h3>
        <button onclick="simulateLoad()">Simulate Notification Load</button>
        <div id="simulateResult" class="result-box"></div>

        <hr>
        <h3>Go to Actual Page:</h3>
        <a href="home.php" style="display:inline-block; padding:12px 24px; background:#28a745; color:white; text-decoration:none; border-radius:5px;">Open Home Page</a>
        <p><small>After opening, press F12 and check Console tab for errors</small></p>
    </div>

    <script>
        function checkElements() {
            const result = document.getElementById('elementsResult');
            let html = '<h4>DOM Element Check:</h4><ul>';
            
            const elements = {
                'notificationBtn': document.getElementById('notificationBtn'),
                'notificationDropdown': document.getElementById('notificationDropdown'),
                'notificationList': document.getElementById('notificationList'),
                'notificationBadge': document.getElementById('notificationBadge'),
                'notificationWrapper': document.querySelector('.wm-notification-wrapper')
            };
            
            for (const [name, element] of Object.entries(elements)) {
                if (element) {
                    html += `<li class="success">‚úÖ ${name} - FOUND</li>`;
                } else {
                    html += `<li class="error">‚ùå ${name} - NOT FOUND</li>`;
                }
            }
            
            html += '</ul>';
            result.innerHTML = html;
        }

        async function testAPI() {
            const result = document.getElementById('apiResult');
            result.innerHTML = '<p>Testing API...</p>';
            
            try {
                const response = await fetch('api/get_notifications.php');
                console.log('API Response Status:', response.status);
                
                const data = await response.json();
                console.log('API Data:', data);
                
                let html = '<h4>API Response:</h4>';
                html += `<p>Success: <span class="${data.success ? 'success' : 'error'}">${data.success}</span></p>`;
                html += `<p>Notifications Count: <strong>${data.notifications ? data.notifications.length : 0}</strong></p>`;
                html += `<p>Unread Count: <strong>${data.unread_count}</strong></p>`;
                
                if (data.notifications && data.notifications.length > 0) {
                    html += '<h5>Notifications:</h5><ul>';
                    data.notifications.forEach(n => {
                        html += `<li>${n.title} (${n.type}) - Read: ${n.is_read}</li>`;
                    });
                    html += '</ul>';
                }
                
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                result.innerHTML = html;
            } catch (error) {
                console.error('API Error:', error);
                result.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        function testBadge() {
            const result = document.getElementById('badgeResult');
            const badge = document.getElementById('notificationBadge');
            
            if (!badge) {
                result.innerHTML = '<p class="error">‚ùå Badge element not found!</p>';
                return;
            }
            
            let html = '<h4>Badge Update Test:</h4>';
            
            // Test showing badge
            badge.textContent = '5';
            badge.style.display = 'inline-block';
            html += '<p>Badge set to show "5"</p>';
            html += '<p>Current display: ' + badge.style.display + '</p>';
            html += '<p>Current text: ' + badge.textContent + '</p>';
            
            result.innerHTML = html;
        }

        async function simulateLoad() {
            const result = document.getElementById('simulateResult');
            result.innerHTML = '<p>Simulating notification load...</p>';
            
            try {
                // Call API
                const response = await fetch('api/get_notifications.php');
                const data = await response.json();
                
                let html = '<h4>Simulation Results:</h4>';
                
                if (data.success) {
                    html += `<p class="success">‚úÖ API returned successfully</p>`;
                    html += `<p>Notifications: ${data.notifications.length}</p>`;
                    html += `<p>Unread: ${data.unread_count}</p>`;
                    
                    // Test badge update
                    const badge = document.getElementById('notificationBadge');
                    if (badge) {
                        if (data.unread_count > 0) {
                            badge.textContent = data.unread_count > 99 ? '99+' : data.unread_count;
                            badge.style.display = 'inline-block';
                            html += `<p class="success">‚úÖ Badge should show: ${badge.textContent}</p>`;
                        } else {
                            badge.style.display = 'none';
                            html += `<p class="warning">‚ö†Ô∏è Badge hidden (no unread)</p>`;
                        }
                    }
                    
                    // Test notification display
                    if (data.notifications.length > 0) {
                        html += '<h5>Would display notifications:</h5><ul>';
                        data.notifications.forEach(n => {
                            html += `<li>${n.title} - ${n.type} - ${n.is_read == 1 ? 'Read' : 'Unread'}</li>`;
                        });
                        html += '</ul>';
                    }
                } else {
                    html += `<p class="error">‚ùå API failed: ${data.error || 'Unknown error'}</p>`;
                }
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
